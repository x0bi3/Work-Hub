<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Work Hub - Employee Portal">
    <title>Work Hub Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0f766e;
            --primary-light: #14b8a6;
            --primary-dark: #115e59;
            --secondary: #7c3aed;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --light: #f0fdfc;
            --text: #1a1a1a;
            --text-light: #666;
            --border: #e0e0e0;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: #fafafa;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            opacity: 0.95;
            font-size: 1rem;
        }

        /* Main Navigation */
        .main-nav {
            background: var(--primary-dark);
            display: flex;
            overflow-x: auto;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            min-width: 200px;
            padding: 1rem;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-tab.active {
            background: var(--primary);
            border-bottom-color: var(--accent);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Page Sections */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        h3 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* FAQ Page */
        .faq-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .category-dropdown {
            margin-bottom: 2rem;
        }

        .category-dropdown select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            background: white;
            color: var(--text);
        }

        .category-dropdown select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1);
        }

        .faq-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .faq-question {
            padding: 1.5rem;
            background: var(--light);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .faq-question:hover {
            background: var(--primary);
            color: white;
        }

        .faq-toggle {
            font-size: 1.5rem;
            transition: transform 0.3s;
        }

        .faq-toggle.open {
            transform: rotate(180deg);
        }

        .faq-answer {
            padding: 1.5rem;
            display: none;
            background: white;
            border-top: 2px solid var(--light);
            color: var(--text-light);
            line-height: 1.8;
        }

        .faq-answer.open {
            display: block;
        }

        /* Carousel Section */
        .carousel-section {
            margin-bottom: 3rem;
        }

        .carousel-container {
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 2rem;
        }

        .carousel-track {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 1rem 0;
            scroll-snap-type: x mandatory;
        }

        .carousel-track::-webkit-scrollbar {
            height: 8px;
        }

        .carousel-track::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .carousel-slide {
            flex: 0 0 calc(100% - 2rem);
            min-height: 300px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 8px;
            padding: 2rem;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            scroll-snap-align: start;
            transition: transform 0.3s;
        }

        .carousel-slide:hover {
            transform: translateY(-4px);
        }

        .carousel-slide h4 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .carousel-slide p {
            opacity: 0.95;
            margin-bottom: 1.5rem;
            flex-grow: 1;
        }

        .carousel-btn {
            align-self: flex-start;
            background: white;
            color: var(--primary);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .carousel-btn:hover {
            background: var(--accent);
            color: white;
        }

        .carousel-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            border: 2px solid var(--light);
        }

        .carousel-content h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .carousel-content p {
            color: var(--text-light);
            line-height: 1.8;
        }

        /* Calendar Section */
        .calendar-wrapper {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .calendar {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .calendar-header button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }

        .calendar-header h3 {
            margin: 0;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .weekday {
            text-align: center;
            font-weight: 700;
            color: var(--primary);
            padding: 0.5rem 0;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .day {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .day:hover {
            background: var(--light);
            border-color: var(--primary);
        }

        .day.has-event {
            background: var(--light);
            border-color: var(--primary);
            font-weight: 600;
            color: var(--primary);
        }

        .day.has-event::after {
            content: '\25cf';
            position: absolute;
            bottom: 2px;
            right: 5px;
            color: var(--accent);
            font-size: 1rem;
        }

        .day.other-month {
            color: var(--border);
            cursor: default;
        }

        .day.other-month:hover {
            background: transparent;
            border-color: var(--border);
        }

        /* Events List */
        .events-list {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .events-list h3 {
            margin-top: 0;
        }

        .event-item {
            padding: 1rem;
            border-left: 4px solid var(--primary);
            margin-bottom: 1rem;
            background: var(--light);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .event-item:hover,
        .event-item.active {
            background: var(--primary);
            color: white;
            border-left-color: var(--accent);
            transform: translateX(4px);
        }

        .event-item h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .event-item p {
            margin: 0.25rem 0;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* Newsletter Section */
        .newsletter-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        .newsletter-list {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .newsletter-item {
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .newsletter-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .newsletter-item h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .newsletter-item .date {
            color: var(--text-light);
            font-size: 0.85rem;
        }

        .newsletter-signup {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 8px;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            height: fit-content;
        }

        .newsletter-signup h3 {
            color: white;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
        }

        .message {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.success {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--success);
            color: white;
            display: block;
        }

        .message.error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
            color: white;
            display: block;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .calendar-wrapper {
                grid-template-columns: 1fr;
            }

            .events-list {
                position: static;
            }

            .newsletter-wrapper {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }

            .nav-tab {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
                min-width: 150px;
            }

            .container {
                padding: 1rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .carousel-slide {
                flex: 0 0 calc(100% - 1rem);
                min-height: 250px;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üìö Work Hub Portal</h1>
        <p>Your Employee Resource Center</p>
    </header>

    <nav class="main-nav">
        <button class="nav-tab active" onclick="showPage('faq')">‚ùì F.A.Q.</button>
        <button class="nav-tab" onclick="showPage('knowmore')">üí° The More You Know</button>
        <button class="nav-tab" onclick="showPage('calendar')">üìÖ DC Calendar Events</button>
        <button class="nav-tab" onclick="showPage('newsletter')">üì¨ Newsletter</button>
    </nav>

    <div class="container">
        <!-- FAQ Page -->
        <div id="faq" class="page active">
            <h2>‚ùì Frequently Asked Questions</h2>
            <div class="faq-container">
                <div class="category-dropdown">
                    <label for="faq-category"><strong>Select Category:</strong></label>
                    <select id="faq-category" onchange="filterFAQ(this.value)">
                        <option value="all">All Categories</option>
                        <option value="working-out-of-area">Working Out Of Area</option>
                        <option value="auditing">Auditing Expectations</option>
                        <option value="benefits">Benefits</option>
                    </select>
                </div>
                <div id="faq-items"></div>
            </div>
        </div>

        <!-- The More You Know Page -->
        <div id="knowmore" class="page">
            <h2>üí° The More You Know</h2>
            <div class="carousel-section">
                <div class="carousel-container">
                    <div class="carousel-track" id="carousel">
                        <!-- Slides will be generated here -->
                    </div>
                </div>
                <div class="carousel-content" id="carousel-content">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Calendar Events Page -->
        <div id="calendar" class="page">
            <h2>üìÖ DC Calendar Events</h2>
            <div class="calendar-wrapper">
                <div class="calendar">
                    <div class="calendar-header">
                        <button onclick="prevMonth()">‚Üê Prev</button>
                        <h3 id="calendar-month"></h3>
                        <button onclick="nextMonth()">Next ‚Üí</button>
                    </div>
                    <div class="weekdays">
                        <div class="weekday">Sun</div>
                        <div class="weekday">Mon</div>
                        <div class="weekday">Tue</div>
                        <div class="weekday">Wed</div>
                        <div class="weekday">Thu</div>
                        <div class="weekday">Fri</div>
                        <div class="weekday">Sat</div>
                    </div>
                    <div class="days" id="calendar-days"></div>
                </div>
                <div class="events-list">
                    <h3>Events</h3>
                    <div id="events-items"></div>
                </div>
            </div>
        </div>

        <!-- Newsletter Page -->
        <div id="newsletter" class="page">
            <h2>üì¨ Newsletter</h2>
            <div class="newsletter-wrapper">
                <div class="newsletter-list">
                    <h3>Previous Newsletters</h3>
                    <div id="newsletter-items"></div>
                </div>
                <div class="newsletter-signup">
                    <h3>Subscribe to Newsletter</h3>
                    <div id="newsletter-message" class="message"></div>
                    <form id="newsletter-form" onsubmit="handleNewsletterSignup(event)">
                        <div class="form-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" name="name" placeholder="Your Name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" placeholder="your@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="department">Department</label>
                            <input type="text" id="department" name="department" placeholder="Your Department" required>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="frequency" name="frequency" checked>
                            <label for="frequency">Send me weekly digests</label>
                        </div>
                        <button type="submit" class="submit-btn" id="submit-btn">Subscribe Now</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Update these with your GitHub repository details
        const GITHUB_REPO = 'x0bi3/Work-Hub'; // Format: username/repo-name
        const GITHUB_BRANCH = 'main'; // Your default branch name
        
        // Authentication Setup:
        // Option 1: Use GitHub Secret (WORKHUB_GH_PAT) via repository_dispatch (recommended)
        // Option 2: Set token in browser console: localStorage.setItem('github_token', 'YOUR_TOKEN')
        // Note: Tokens in localStorage are visible to users - use only for testing!

        // FAQ Data
        const faqData = {
            'working-out-of-area': [
                {
                    q: 'What is the process for working out of area?',
                    a: 'To work out of your assigned area, you must first speak with your direct manager. They will review the request and submit it through the proper channels for approval. Once approved, you\'ll receive confirmation and any necessary documentation.'
                },
                {
                    q: 'How far can I travel for an out-of-area assignment?',
                    a: 'Out-of-area assignments can typically be within a 50-mile radius of your home location. For assignments beyond this, you may be eligible for additional travel allowances. Contact HR for specifics.'
                },
                {
                    q: 'Do I get paid differently when working out of area?',
                    a: 'Pay rates remain the same for out-of-area work. However, you may be eligible for travel reimbursement or a travel stipend depending on the distance and duration of your assignment.'
                }
            ],
            'auditing': [
                {
                    q: 'What are auditing expectations?',
                    a: 'Audits are conducted to ensure compliance with company standards. You should maintain accurate records, follow all procedures, and be prepared to explain your work processes to auditors. Documentation is key.'
                },
                {
                    q: 'How often will I be audited?',
                    a: 'Audit frequency varies by department and role. Most departments undergo audits quarterly. You\'ll receive notification before an audit occurs.'
                },
                {
                    q: 'What happens if I fail an audit?',
                    a: 'If audit findings are identified, you\'ll receive a remediation plan. Work with your manager to address any gaps. Follow-up audits will be scheduled to verify improvements.'
                }
            ],
            'benefits': [
                {
                    q: 'What benefits am I eligible for?',
                    a: 'Eligibility depends on your employment status and tenure. Full-time employees are typically eligible for health insurance, 401(k), paid time off, and other benefits. Check your employee handbook for complete details.'
                },
                {
                    q: 'When can I enroll in benefits?',
                    a: 'New employees have 30 days from hire date to enroll. Existing employees can make changes during annual open enrollment (typically October-November) or upon a qualifying life event.'
                },
                {
                    q: 'What is the company\'s matching contribution for 401(k)?',
                    a: 'The company matches 100% of contributions up to 3% of salary, and 50% of contributions from 3-5%. To receive the full match, contribute at least 5% of your salary.'
                }
            ]
        };

        // Carousel Data
        const carouselSlides = [
            {
                id: 'slide1',
                title: 'Professional Development',
                preview: 'Explore career growth opportunities and training programs...',
                content: 'Our professional development programs are designed to help you grow in your career. We offer tuition reimbursement, mentorship programs, and access to online learning platforms. Invest in yourself and reach your full potential!'
            },
            {
                id: 'slide2',
                title: 'Work-Life Balance',
                preview: 'Discover flexible work arrangements and wellness programs...',
                content: 'We believe in supporting your whole self. Take advantage of flexible schedules, remote work options, and our comprehensive wellness program including gym discounts, mental health resources, and wellness challenges.'
            },
            {
                id: 'slide3',
                title: 'Team Culture',
                preview: 'Be part of a collaborative and inclusive community...',
                content: 'Our strong team culture is built on collaboration and respect. We celebrate diversity, support each other, and create an inclusive environment where everyone can thrive and feel valued.'
            },
            {
                id: 'slide4',
                title: 'Innovation & Creativity',
                preview: 'Share your ideas and shape the future of our organization...',
                content: 'We value innovation at every level. Your ideas matter! We have regular innovation challenges, hack-a-thons, and an open-door policy for suggestions. Help us solve problems and create new solutions.'
            },
            {
                id: 'slide5',
                title: 'Recognition & Rewards',
                preview: 'Your hard work deserves to be celebrated...',
                content: 'We have multiple programs to recognize excellence including employee of the month awards, spot bonuses, and team celebrations. Your contributions don\'t go unnoticed‚Äîwe celebrate your success!'
            }
        ];

        // Calendar Events Data
        const calendarEvents = [
            { date: 15, month: 0, title: 'Team Building Day', description: 'Join us for an afternoon of team activities' },
            { date: 20, month: 0, title: 'Training Workshop', description: 'Professional development workshop' },
            { date: 5, month: 1, title: 'All Hands Meeting', description: 'Company-wide all hands meeting' },
            { date: 14, month: 1, title: 'Holiday Party', description: 'Annual company holiday celebration' },
            { date: 1, month: 2, title: 'Q1 Review', description: 'Q1 Performance reviews begin' }
        ];

        // Newsletter Data
        const newsletters = [
            { date: 'Dec 20, 2024', title: 'December Holiday Edition', preview: 'Holiday tips, party info, and year-end updates' },
            { date: 'Dec 13, 2024', title: 'New Benefits Announcement', preview: 'Details about our expanded benefits package' },
            { date: 'Dec 6, 2024', title: 'Team Recognition Spotlight', preview: 'Celebrating our outstanding team members' },
            { date: 'Nov 29, 2024', title: 'Q4 Initiatives', preview: 'Overview of Q4 company initiatives' },
            { date: 'Nov 22, 2024', title: 'Training Opportunities', preview: 'New training programs and certifications available' }
        ];

        // Initialize
        let currentMonth = new Date();
        let currentSlide = 0;

        function init() {
            renderFAQ('all');
            renderCarousel();
            loadCarouselContent('slide1');
            renderCalendar();
            renderEvents();
            renderNewsletters();
        }

        // Navigation
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageName).classList.add('active');
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        // FAQ Functions
        function renderFAQ(category) {
            const container = document.getElementById('faq-items');
            let items = [];
            
            if (category === 'all') {
                Object.values(faqData).forEach(cat => items.push(...cat));
            } else {
                items = faqData[category] || [];
            }

            container.innerHTML = items.map((item, idx) => `
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>${item.q}</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        ${item.a}
                    </div>
                </div>
            `).join('');
        }

        function filterFAQ(category) {
            renderFAQ(category);
        }

        function toggleFAQ(element) {
            const question = element;
            const answer = element.nextElementSibling;
            const toggle = element.querySelector('.faq-toggle');
            
            answer.classList.toggle('open');
            toggle.classList.toggle('open');
        }

        // Carousel Functions
        function renderCarousel() {
            const carousel = document.getElementById('carousel');
            carousel.innerHTML = carouselSlides.map(slide => `
                <div class="carousel-slide">
                    <div>
                        <h4>${slide.title}</h4>
                        <p>${slide.preview}</p>
                    </div>
                    <button class="carousel-btn" onclick="loadCarouselContent('${slide.id}')">Learn More</button>
                </div>
            `).join('');
        }

        function loadCarouselContent(slideId) {
            const slide = carouselSlides.find(s => s.id === slideId);
            const content = document.getElementById('carousel-content');
            content.innerHTML = `
                <h4>${slide.title}</h4>
                <p>${slide.content}</p>
            `;
        }

        // Calendar Functions
        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            document.getElementById('calendar-month').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            let html = '';
            
            // Previous month days
            for (let i = firstDay.getDay(); i > 0; i--) {
                html += `<div class="day other-month">${prevLastDay.getDate() - i + 1}</div>`;
            }
            
            // Current month days
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const hasEvent = calendarEvents.some(e => e.date === i && e.month === month);
                html += `<div class="day ${hasEvent ? 'has-event' : ''}" onclick="selectDate(${i})">${i}</div>`;
            }
            
            // Next month days
            for (let i = 1; i <= (35 - lastDay.getDate() - firstDay.getDay() + 1); i++) {
                html += `<div class="day other-month">${i}</div>`;
            }
            
            document.getElementById('calendar-days').innerHTML = html;
        }

        function prevMonth() {
            currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1);
            renderCalendar();
        }

        function selectDate(day) {
            const events = calendarEvents.filter(e => e.date === day && e.month === currentMonth.getMonth());
            const list = document.getElementById('events-items');
            
            if (events.length > 0) {
                list.innerHTML = events.map((e, idx) => `
                    <div class="event-item active">
                        <h4>${e.title}</h4>
                        <p>üìÖ ${currentMonth.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}</p>
                        <p>${e.description}</p>
                    </div>
                `).join('');
            }
        }

        function renderEvents() {
            const list = document.getElementById('events-items');
            list.innerHTML = calendarEvents.map(e => {
                const eventDate = new Date(currentMonth.getFullYear(), e.month, e.date);
                return `
                    <div class="event-item" onclick="selectDateFromEvent(${e.date})">
                        <h4>${e.title}</h4>
                        <p>üìÖ ${eventDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</p>
                        <p>${e.description}</p>
                    </div>
                `;
            }).join('');
        }

        function selectDateFromEvent(day) {
            document.querySelectorAll('.event-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            selectDate(day);
        }

        // Newsletter Functions
        function renderNewsletters() {
            const container = document.getElementById('newsletter-items');
            container.innerHTML = newsletters.map(letter => `
                <div class="newsletter-item">
                    <h4>${letter.title}</h4>
                    <div class="date">${letter.date}</div>
                    <p style="margin-top: 0.5rem;">${letter.preview}</p>
                </div>
            `).join('');
        }

        async function handleNewsletterSignup(event) {
            event.preventDefault();
            const form = event.target;
            const submitBtn = document.getElementById('submit-btn');
            const messageDiv = document.getElementById('newsletter-message');
            
            const formData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                department: document.getElementById('department').value.trim(),
                weeklyDigest: document.getElementById('frequency').checked,
                subscribedAt: new Date().toISOString()
            };

            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = 'Subscribing...';
            messageDiv.className = 'message';
            messageDiv.style.display = 'none';

            try {
                print('[newsletter] Submitting subscription:', formData.email);
                
                // Try to get GitHub token from localStorage (set via browser console)
                // This token is used to trigger repository_dispatch, which then uses WORKHUB_GH_PAT secret server-side
                const githubToken = localStorage.getItem('github_token') || '';
                
                if (!githubToken) {
                    // No token - store locally and show instructions
                    const pendingSubmissions = JSON.parse(localStorage.getItem('pendingNewsletterSubscriptions') || '[]');
                    pendingSubmissions.push({
                        ...formData,
                        submittedAt: new Date().toISOString(),
                        id: Date.now().toString()
                    });
                    localStorage.setItem('pendingNewsletterSubscriptions', JSON.stringify(pendingSubmissions));
                    
                    throw new Error('GitHub authentication required. Please see SETUP_TOKEN.md for setup instructions. Your subscription has been saved locally and will be processed once authentication is configured.');
                }
                
                print('[newsletter] Triggering workflow via repository_dispatch...');
                
                // Use repository_dispatch to trigger the workflow
                // The workflow will use WORKHUB_GH_PAT secret server-side for processing
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/vnd.github.v3+json',
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        event_type: 'newsletter-subscription',
                        client_payload: {
                            subscriber: formData
                        }
                    })
                });

                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        localStorage.removeItem('github_token'); // Remove invalid token
                        throw new Error('Invalid GitHub token or insufficient permissions. Please check SETUP_TOKEN.md and ensure your token has "repo" scope. Your subscription has been saved locally.');
                    }
                    const errorText = await response.text();
                    let errorMessage = 'Failed to submit subscription';
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.message || errorMessage;
                    } catch (e) {
                        errorMessage = errorText || errorMessage;
                    }
                    throw new Error(errorMessage);
                }

                print('[newsletter] Subscription submitted successfully. Workflow triggered.');
                const result = { success: true, message: 'Workflow triggered successfully' };
                
                // Show success message
                messageDiv.className = 'message success';
                messageDiv.textContent = `Thank you ${formData.name}! Your subscription has been submitted. You'll receive a confirmation email shortly.`;
                messageDiv.style.display = 'block';
                
                // Reset form
                form.reset();
                
                // Scroll to message
                messageDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
            } catch (error) {
                print('[newsletter] Error submitting subscription:', error.message);
                log('Newsletter subscription error', { error: error.message, formData });
                
                messageDiv.className = 'message error';
                let errorMsg = error.message;
                
                // Provide helpful instructions for auth errors
                if (error.message.includes('authentication') || error.message.includes('token') || error.message.includes('GitHub')) {
                    errorMsg += '\n\nüìù To set up authentication:\n' +
                               '1. Open browser console (F12)\n' +
                               '2. Run: localStorage.setItem("github_token", "YOUR_TOKEN_HERE")\n' +
                               '3. See AUTH_SETUP.md for token creation instructions\n\n' +
                               'Your subscription has been saved locally and will be processed once configured.';
                } else {
                    errorMsg = `Sorry, there was an error: ${error.message}\n\nPlease try again later or contact support.`;
                }
                
                messageDiv.textContent = errorMsg;
                messageDiv.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Subscribe Now';
            }
        }

        // Helper functions for logging
        function print(message, ...args) {
            console.log(message, ...args);
        }

        function log(message, data) {
            console.error('[LOG]', message, data);
        }

        // Initialize on load
        init();
    </script>
</body>
</html>

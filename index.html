<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Work Hub - Employee Portal">
    <!-- Prevent browser caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Work Hub Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0f766e;
            --primary-light: #14b8a6;
            --primary-dark: #115e59;
            --secondary: #7c3aed;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --light: #f0fdfc;
            --text: #1a1a1a;
            --text-light: #666;
            --border: #e0e0e0;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: #fafafa;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            opacity: 0.95;
            font-size: 1rem;
        }

        /* Main Navigation */
        .main-nav {
            background: var(--primary-dark);
            display: flex;
            overflow-x: auto;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            min-width: 200px;
            padding: 1rem;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-tab.active {
            background: var(--primary);
            border-bottom-color: var(--accent);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Page Sections */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        h3 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* FAQ Page */
        .faq-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .category-dropdown {
            margin-bottom: 2rem;
        }

        .category-dropdown select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            background: white;
            color: var(--text);
        }

        .category-dropdown select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1);
        }

        .faq-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .faq-question {
            padding: 1.5rem;
            background: var(--light);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .faq-question:hover {
            background: var(--primary);
            color: white;
        }

        .faq-toggle {
            font-size: 1.5rem;
            transition: transform 0.3s;
        }

        .faq-toggle.open {
            transform: rotate(180deg);
        }

        .faq-answer {
            padding: 1.5rem;
            display: none;
            background: white;
            border-top: 2px solid var(--light);
            color: var(--text-light);
            line-height: 1.8;
        }

        .faq-answer.open {
            display: block;
        }

        /* Carousel Section */
        .carousel-section {
            margin-bottom: 3rem;
        }

        .carousel-container {
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 2rem;
        }

        .carousel-track {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 1rem 0;
            scroll-snap-type: x mandatory;
        }

        .carousel-track::-webkit-scrollbar {
            height: 8px;
        }

        .carousel-track::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .carousel-slide {
            flex: 0 0 calc(100% - 2rem);
            min-height: 300px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 8px;
            padding: 2rem;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            scroll-snap-align: start;
            transition: transform 0.3s;
        }

        .carousel-slide:hover {
            transform: translateY(-4px);
        }

        .carousel-slide h4 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .carousel-slide p {
            opacity: 0.95;
            margin-bottom: 1.5rem;
            flex-grow: 1;
        }

        .carousel-btn {
            align-self: flex-start;
            background: white;
            color: var(--primary);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .carousel-btn:hover {
            background: var(--accent);
            color: white;
        }

        .carousel-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            border: 2px solid var(--light);
        }

        .carousel-content h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .carousel-content p {
            color: var(--text-light);
            line-height: 1.8;
        }

        /* Calendar Section */
        .calendar-wrapper {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .calendar {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .calendar-header button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }

        .calendar-header h3 {
            margin: 0;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .weekday {
            text-align: center;
            font-weight: 700;
            color: var(--primary);
            padding: 0.5rem 0;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .day {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .day:hover {
            background: var(--light);
            border-color: var(--primary);
        }

        .day.has-event {
            background: var(--light);
            border-color: var(--primary);
            font-weight: 600;
            color: var(--primary);
        }

        .day.has-event::after {
            content: '\25cf';
            position: absolute;
            bottom: 2px;
            right: 5px;
            color: var(--accent);
            font-size: 1rem;
        }

        .day.other-month {
            color: var(--border);
            cursor: default;
        }

        .day.other-month:hover {
            background: transparent;
            border-color: var(--border);
        }

        /* Events List */
        .events-list {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .events-list h3 {
            margin-top: 0;
        }

        .event-item {
            padding: 1rem;
            border-left: 4px solid var(--primary);
            margin-bottom: 1rem;
            background: var(--light);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .event-item:hover,
        .event-item.active {
            background: var(--primary);
            color: white;
            border-left-color: var(--accent);
            transform: translateX(4px);
        }

        .event-item h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .event-item p {
            margin: 0.25rem 0;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* Newsletter Section */
        .newsletter-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        .newsletter-list {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .newsletter-item {
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .newsletter-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .newsletter-item h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .newsletter-item .date {
            color: var(--text-light);
            font-size: 0.85rem;
        }

        .newsletter-signup {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 8px;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            height: fit-content;
        }

        .newsletter-signup h3 {
            color: white;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
        }

        .message {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.success {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--success);
            color: white;
            display: block;
        }

        .message.error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
            color: white;
            display: block;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .calendar-wrapper {
                grid-template-columns: 1fr;
            }

            .events-list {
                position: static;
            }

            .newsletter-wrapper {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }

            .nav-tab {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
                min-width: 150px;
            }

            .container {
                padding: 1rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .carousel-slide {
                flex: 0 0 calc(100% - 1rem);
                min-height: 250px;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üìö Work Hub Portal</h1>
        <p>Your Employee Resource Center</p>
    </header>

    <nav class="main-nav">
        <button class="nav-tab active" onclick="showPage('faq')">‚ùì F.A.Q.</button>
        <button class="nav-tab" onclick="showPage('knowmore')">üí° The More You Know</button>
        <button class="nav-tab" onclick="showPage('calendar')">üìÖ DC Calendar Events</button>
        <button class="nav-tab" onclick="showPage('newsletter')">üì¨ Newsletter</button>
    </nav>

    <div class="container">
        <!-- FAQ Page -->
        <div id="faq" class="page active">
            <h2>‚ùì Frequently Asked Questions</h2>
            <div class="faq-container">
                <div class="category-dropdown">
                    <label for="faq-category"><strong>Select Category:</strong></label>
                    <select id="faq-category" onchange="filterFAQ(this.value)">
                        <option value="all">All Categories</option>
                        <option value="working-out-of-area">Working Out Of Area</option>
                        <option value="auditing">Auditing Expectations</option>
                        <option value="benefits">Benefits</option>
                    </select>
                </div>
                <div id="faq-items"></div>
            </div>
        </div>

        <!-- The More You Know Page -->
        <div id="knowmore" class="page">
            <h2>üí° The More You Know</h2>
            <div class="carousel-section">
                <div class="carousel-container">
                    <div class="carousel-track" id="carousel">
                        <!-- Slides will be generated here -->
                    </div>
                </div>
                <div class="carousel-content" id="carousel-content">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Calendar Events Page -->
        <div id="calendar" class="page">
            <h2>üìÖ DC Calendar Events</h2>
            <div class="calendar-wrapper">
                <div class="calendar">
                    <div class="calendar-header">
                        <button onclick="prevMonth()">‚Üê Prev</button>
                        <h3 id="calendar-month"></h3>
                        <button onclick="nextMonth()">Next ‚Üí</button>
                    </div>
                    <div class="weekdays">
                        <div class="weekday">Sun</div>
                        <div class="weekday">Mon</div>
                        <div class="weekday">Tue</div>
                        <div class="weekday">Wed</div>
                        <div class="weekday">Thu</div>
                        <div class="weekday">Fri</div>
                        <div class="weekday">Sat</div>
                    </div>
                    <div class="days" id="calendar-days"></div>
                </div>
                <div class="events-list">
                    <h3>Events</h3>
                    <div id="events-items"></div>
                </div>
            </div>
        </div>

        <!-- Newsletter Page -->
        <div id="newsletter" class="page">
            <h2>üì¨ Newsletter</h2>
            <div class="newsletter-wrapper">
                <div class="newsletter-list">
                    <h3>Previous Newsletters</h3>
                    <div id="newsletter-items"></div>
                </div>
                <div class="newsletter-signup">
                    <h3>Subscribe to Newsletter</h3>
                    <div id="newsletter-message" class="message"></div>
                    <form id="newsletter-form" onsubmit="handleNewsletterSignup(event)">
                        <div class="form-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" name="name" placeholder="Your Name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" placeholder="your@email.com" required>
                        </div>
                        <button type="submit" class="submit-btn" id="submit-btn">Subscribe Now</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Update these with your GitHub repository details
        const GITHUB_REPO = 'x0bi3/Work-Hub'; // Format: username/repo-name
        const GITHUB_BRANCH = 'main'; // Your default branch name

        // Dynamic data (loaded from GitHub)
        let faqData = {};
        let faqCategories = [];
        let carouselSlides = [];

        /**
         * Fetch FAQ data from GitHub
         * Loads from resources/faq/manifest.json and individual question files
         */
        async function fetchFAQFromGitHub() {
            console.log('‚ùì Loading FAQ data...');
            const container = document.getElementById('faq-items');
            container.innerHTML = '<p style="color: var(--text-light);">Loading FAQ...</p>';
            
            // Cache buster to ensure fresh data
            const cacheBuster = `?t=${Date.now()}`;
            
            try {
                // Load manifest
                const manifestUrl = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}/resources/faq/manifest.json${cacheBuster}`;
                const manifestResponse = await fetch(manifestUrl, { cache: 'no-store' });
                
                if (!manifestResponse.ok) {
                    throw new Error('FAQ manifest not found');
                }
                
                const manifest = await manifestResponse.json();
                faqCategories = manifest.categories || [];
                
                // Update category dropdown
                const categorySelect = document.getElementById('faq-category');
                if (categorySelect) {
                    categorySelect.innerHTML = '<option value="all">All Categories</option>' +
                        faqCategories.map(c => `<option value="${c.id}">${c.icon} ${c.name}</option>`).join('');
                }
                
                // Load each FAQ item
                faqData = {};
                for (const fileName of manifest.items) {
                    try {
                        const itemUrl = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}/resources/faq/${fileName}${cacheBuster}`;
                        const itemResponse = await fetch(itemUrl, { cache: 'no-store' });
                        if (itemResponse.ok) {
                            const item = await itemResponse.json();
                            if (!faqData[item.category]) {
                                faqData[item.category] = [];
                            }
                            faqData[item.category].push({
                                q: item.question,
                                a: item.answer,
                                order: item.order
                            });
                        }
                    } catch (e) {
                        console.warn(`Failed to load FAQ item: ${fileName}`);
                    }
                }
                
                // Sort items by order within each category
                for (const category in faqData) {
                    faqData[category].sort((a, b) => a.order - b.order);
                }
                
                console.log('‚úÖ Loaded FAQ data:', Object.keys(faqData).length, 'categories');
                
            } catch (error) {
                console.error('‚ùå Failed to load FAQ:', error);
                container.innerHTML = '<p style="color: var(--danger);">Failed to load FAQ. Please try again later.</p>';
            }
        }

        /**
         * Fetch TMYK (The More You Know) data from GitHub
         * Loads from resources/tmyk/manifest.json and individual topic files
         */
        async function fetchTMYKFromGitHub() {
            console.log('üí° Loading TMYK data...');
            
            // Cache buster to ensure fresh data
            const cacheBuster = `?t=${Date.now()}`;
            
            try {
                // Load manifest
                const manifestUrl = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}/resources/tmyk/manifest.json${cacheBuster}`;
                const manifestResponse = await fetch(manifestUrl, { cache: 'no-store' });
                
                if (!manifestResponse.ok) {
                    throw new Error('TMYK manifest not found');
                }
                
                const manifest = await manifestResponse.json();
                carouselSlides = [];
                
                // Load each TMYK item
                for (const fileName of manifest.items) {
                    try {
                        const itemUrl = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}/resources/tmyk/${fileName}${cacheBuster}`;
                        const itemResponse = await fetch(itemUrl, { cache: 'no-store' });
                        if (itemResponse.ok) {
                            const item = await itemResponse.json();
                            carouselSlides.push({
                                id: item.id,
                                title: item.title,
                                icon: item.icon,
                                preview: item.preview,
                                content: item.content,
                                order: item.order
                            });
                        }
                    } catch (e) {
                        console.warn(`Failed to load TMYK item: ${fileName}`);
                    }
                }
                
                // Sort by order
                carouselSlides.sort((a, b) => a.order - b.order);
                
                console.log('‚úÖ Loaded TMYK data:', carouselSlides.length, 'slides');
                
            } catch (error) {
                console.error('‚ùå Failed to load TMYK:', error);
            }
        }

        // Calendar Events Data
        const calendarEvents = [
            { date: 15, month: 0, title: 'Team Building Day', description: 'Join us for an afternoon of team activities' },
            { date: 20, month: 0, title: 'Training Workshop', description: 'Professional development workshop' },
            { date: 5, month: 1, title: 'All Hands Meeting', description: 'Company-wide all hands meeting' },
            { date: 14, month: 1, title: 'Holiday Party', description: 'Annual company holiday celebration' },
            { date: 1, month: 2, title: 'Q1 Review', description: 'Q1 Performance reviews begin' }
        ];

        // Newsletter Data (will be populated from GitHub)
        let newsletters = [];

        // Initialize
        let currentMonth = new Date();
        let currentSlide = 0;

        /**
         * Fetch newsletters from GitHub repository
         * Loads from newsletters/manifest.json (auto-updated by admin panel)
         * Falls back to GitHub API if manifest not available
         */
        async function fetchNewslettersFromGitHub() {
            try {
                // First, show some feedback to the user
                const container = document.getElementById('newsletter-items');
                container.innerHTML = '<p style="color: var(--text-light);">Loading newsletters...</p>';
                
                console.log('üì∞ Attempting to load newsletters...');
                
                // Try to load from the newsletter manifest (primary source)
                try {
                    const manifestUrl = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}/newsletters/manifest.json`;
                    console.log('üìÑ Loading from newsletter manifest:', manifestUrl);
                    const manifestResponse = await fetch(manifestUrl);
                    
                    if (manifestResponse.ok) {
                        const manifest = await manifestResponse.json();
                        console.log('‚úÖ Loaded manifest with', manifest.newsletters.length, 'entries');
                        
                        // Filter to only published newsletters and fetch their content
                        const published = manifest.newsletters.filter(n => n.status === 'published');
                        const parsed = [];
                        
                        for (const entry of published) {
                            try {
                                const contentUrl = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}/${entry.path}`;
                                const contentResponse = await fetch(contentUrl);
                                if (contentResponse.ok) {
                                    const htmlContent = await contentResponse.text();
                                    const newsletter = parseNewsletter(htmlContent);
                                    // Use manifest metadata as fallback
                                    newsletter.title = newsletter.title || entry.title;
                                    newsletter.publishDate = newsletter.publishDate || entry.publishDate;
                                    newsletter.tags = newsletter.tags.length ? newsletter.tags : (entry.tags || []);
                                    parsed.push(newsletter);
                                }
                            } catch (e) {
                                console.warn(`Failed to fetch ${entry.title}:`, e);
                            }
                        }
                        
                        parsed.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
                        newsletters = parsed;
                        console.log(`‚úÖ Loaded ${newsletters.length} published newsletters from manifest`);
                        return; // Success - exit early
                    }
                } catch (e) {
                    console.log('üìã Manifest not available, trying GitHub API...', e);
                }
                
                const apiUrl = `https://api.github.com/repos/${GITHUB_REPO}/contents/newsletters?ref=${GITHUB_BRANCH}`;
                console.log('üì∞ Fetching newsletters from GitHub API:', apiUrl);
                
                // Recursively fetch all newsletter files
                const fetchDir = async (path, depth = 0) => {
                    console.log(`  ${'  '.repeat(depth)}Scanning: ${path}`);
                    const response = await fetch(path);
                    
                    if (!response.ok) {
                        console.warn(`  ${'  '.repeat(depth)}‚ùå API returned ${response.status}`);
                        return [];
                    }
                    
                    const contents = await response.json();
                    console.log(`  ${'  '.repeat(depth)}Found ${contents.length} items`);
                    
                    let files = [];
                    
                    for (const item of contents) {
                        if (item.type === 'dir') {
                            console.log(`  ${'  '.repeat(depth)}üìÅ Directory: ${item.name}`);
                            // Recursively fetch subdirectories
                            const subFiles = await fetchDir(item.url, depth + 1);
                            files = files.concat(subFiles);
                        } else if (item.name.endsWith('.html')) {
                            console.log(`  ${'  '.repeat(depth)}üìÑ Newsletter: ${item.name}`);
                            files.push(item);
                        }
                    }
                    return files;
                };
                
                const files = await fetchDir(apiUrl);
                console.log(`‚úÖ Found ${files.length} newsletter files total`);
                
                // Parse each newsletter file
                const parsed = [];
                for (const file of files) {
                    try {
                        console.log(`  Parsing: ${file.name}`);
                        const contentResponse = await fetch(file.download_url);
                        if (!contentResponse.ok) {
                            console.warn(`  ‚ùå Failed to fetch ${file.name}`);
                            continue;
                        }
                        
                        const htmlContent = await contentResponse.text();
                        const newsletter = parseNewsletter(htmlContent);
                        console.log(`  Title: ${newsletter.title}, Status: ${newsletter.status}`);
                        
                        // Only show published newsletters
                        if (newsletter.status === 'published') {
                            parsed.push(newsletter);
                        } else {
                            console.log(`  (Skipped - status is '${newsletter.status}', not 'published')`);
                        }
                    } catch (e) {
                        console.error(`  Error parsing ${file.name}:`, e);
                    }
                }
                
                // Sort by publish date (newest first)
                parsed.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
                newsletters = parsed;
                
                console.log(`‚úÖ Loaded ${newsletters.length} published newsletters:`, newsletters);
            } catch (error) {
                console.error('‚ùå Error fetching newsletters from GitHub:', error);
                console.error('Full error details:', JSON.stringify(error, null, 2));
                // Show error message to user
                const container = document.getElementById('newsletter-items');
                container.innerHTML = `<p style="color: var(--danger);">‚ö†Ô∏è Error loading newsletters: ${error.message}</p>
                    <p style="color: var(--text-light); font-size: 0.9rem;">Please check the browser console for details.</p>`;
                // Fall back to empty array if fetch fails
                newsletters = [];
            }
        }

        /**
         * Parse newsletter HTML to extract metadata and preview
         */
        function parseNewsletter(htmlContent) {
            // Extract metadata from HTML comment block
            const metaMatch = htmlContent.match(/<!--\s*({.*?})\s*-->/s);
            let metadata = {
                title: 'Untitled Newsletter',
                publishDate: new Date().toISOString().split('T')[0],
                status: 'draft',
                tags: []
            };

            if (metaMatch) {
                try {
                    metadata = JSON.parse(metaMatch[1]);
                } catch (e) {
                    console.warn('Failed to parse newsletter metadata', e);
                }
            }

            // Extract body and create preview (first 150 chars)
            const bodyStart = metaMatch ? metaMatch[0].length : 0;
            const body = htmlContent.substring(bodyStart).trim();
            const plainText = body.replace(/<[^>]*>/g, '').trim();
            const preview = plainText.substring(0, 150) + (plainText.length > 150 ? '...' : '');

            // Format date
            const date = new Date(metadata.publishDate);
            const formattedDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });

            return {
                title: metadata.title,
                date: formattedDate,
                preview: preview,
                content: body,
                publishDate: metadata.publishDate,
                status: metadata.status,
                tags: metadata.tags || []
            };
        }

        async function init() {
            // Fetch all dynamic content from GitHub
            await Promise.all([
                fetchFAQFromGitHub(),
                fetchTMYKFromGitHub(),
                fetchNewslettersFromGitHub()
            ]);
            
            // Render all sections
            renderFAQ('all');
            renderCarousel();
            if (carouselSlides.length > 0) {
                loadCarouselContent(carouselSlides[0].id);
            }
            renderCalendar();
            renderEvents();
            renderNewsletters();
        }

        // Navigation
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageName).classList.add('active');
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        // FAQ Functions
        function renderFAQ(category) {
            const container = document.getElementById('faq-items');
            let items = [];
            
            if (category === 'all') {
                Object.values(faqData).forEach(cat => items.push(...cat));
            } else {
                items = faqData[category] || [];
            }

            container.innerHTML = items.map((item, idx) => `
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>${item.q}</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        ${item.a}
                    </div>
                </div>
            `).join('');
        }

        function filterFAQ(category) {
            renderFAQ(category);
        }

        function toggleFAQ(element) {
            const question = element;
            const answer = element.nextElementSibling;
            const toggle = element.querySelector('.faq-toggle');
            
            answer.classList.toggle('open');
            toggle.classList.toggle('open');
        }

        // Carousel Functions
        function renderCarousel() {
            const carousel = document.getElementById('carousel');
            if (carouselSlides.length === 0) {
                carousel.innerHTML = '<p style="color: var(--text-light);">Loading content...</p>';
                return;
            }
            carousel.innerHTML = carouselSlides.map(slide => `
                <div class="carousel-slide">
                    <div>
                        <h4>${slide.icon || ''} ${slide.title}</h4>
                        <p>${slide.preview}</p>
                    </div>
                    <button class="carousel-btn" onclick="loadCarouselContent('${slide.id}')">Learn More</button>
                </div>
            `).join('');
        }

        function loadCarouselContent(slideId) {
            const slide = carouselSlides.find(s => s.id === slideId);
            const content = document.getElementById('carousel-content');
            content.innerHTML = `
                <h4>${slide.title}</h4>
                <p>${slide.content}</p>
            `;
        }

        // Calendar Functions
        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            document.getElementById('calendar-month').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            let html = '';
            
            // Previous month days
            for (let i = firstDay.getDay(); i > 0; i--) {
                html += `<div class="day other-month">${prevLastDay.getDate() - i + 1}</div>`;
            }
            
            // Current month days
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const hasEvent = calendarEvents.some(e => e.date === i && e.month === month);
                html += `<div class="day ${hasEvent ? 'has-event' : ''}" onclick="selectDate(${i})">${i}</div>`;
            }
            
            // Next month days
            for (let i = 1; i <= (35 - lastDay.getDate() - firstDay.getDay() + 1); i++) {
                html += `<div class="day other-month">${i}</div>`;
            }
            
            document.getElementById('calendar-days').innerHTML = html;
        }

        function prevMonth() {
            currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1);
            renderCalendar();
        }

        function selectDate(day) {
            const events = calendarEvents.filter(e => e.date === day && e.month === currentMonth.getMonth());
            const list = document.getElementById('events-items');
            
            if (events.length > 0) {
                list.innerHTML = events.map((e, idx) => `
                    <div class="event-item active">
                        <h4>${e.title}</h4>
                        <p>üìÖ ${currentMonth.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}</p>
                        <p>${e.description}</p>
                    </div>
                `).join('');
            }
        }

        function renderEvents() {
            const list = document.getElementById('events-items');
            list.innerHTML = calendarEvents.map(e => {
                const eventDate = new Date(currentMonth.getFullYear(), e.month, e.date);
                return `
                    <div class="event-item" onclick="selectDateFromEvent(${e.date})">
                        <h4>${e.title}</h4>
                        <p>üìÖ ${eventDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</p>
                        <p>${e.description}</p>
                    </div>
                `;
            }).join('');
        }

        function selectDateFromEvent(day) {
            document.querySelectorAll('.event-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            selectDate(day);
        }

        // Newsletter Functions
        function renderNewsletters() {
            const container = document.getElementById('newsletter-items');
            
            if (newsletters.length === 0) {
                container.innerHTML = '<p style="color: var(--text-light);">No newsletters available yet.</p>';
                return;
            }
            
            container.innerHTML = newsletters.map((letter, idx) => `
                <div class="newsletter-item">
                    <h4>${letter.title}</h4>
                    <div class="date">${letter.date}</div>
                    <p style="margin-top: 0.5rem;">${letter.preview}</p>
                    <button class="view-newsletter-btn" onclick="viewNewsletter(${idx})" style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">View Newsletter</button>
                </div>
            `).join('');
        }
        
        function viewNewsletter(index) {
            const letter = newsletters[index];
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 1rem;';
            modal.innerHTML = `
                <div style="background: white; border-radius: 8px; padding: 2rem; max-width: 800px; max-height: 80vh; overflow-y: auto; position: relative;">
                    <button onclick="this.closest('div').parentElement.remove()" style="position: absolute; top: 1rem; right: 1rem; border: none; background: none; font-size: 1.5rem; cursor: pointer;">√ó</button>
                    <h2>${letter.title}</h2>
                    <div style="color: var(--text-light); margin-bottom: 1.5rem;">${letter.date}</div>
                    <div style="border-top: 1px solid var(--border); padding-top: 1.5rem;">
                        ${letter.content}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
async function handleNewsletterSignup(event) {
    event.preventDefault();
    const form = event.target;
    const submitBtn = document.getElementById('submit-btn');
    const messageDiv = document.getElementById('newsletter-message');
    
    const formData = {
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        subscribedAt: new Date().toISOString()
    };

    // Validate
    if (!formData.name || !formData.email) {
        console.error('[newsletter] ERROR: Validation failed - Missing name or email');
        console.error('[newsletter] Expected: Both name and email to be non-empty strings');
        console.error('[newsletter] Received: name =', formData.name, 'email =', formData.email);
        messageDiv.className = 'message error';
        messageDiv.textContent = 'Please fill in both name and email fields.';
        messageDiv.style.display = 'block';
        return;
    }

    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Subscribing...';
    messageDiv.className = 'message';
    messageDiv.style.display = 'none';

    try {
        console.log('[newsletter] Submitting subscription:', formData.email);
        console.log('[newsletter] Full form data:', JSON.stringify(formData, null, 2));
        
        const GITHUB_REPO = 'x0bi3/Work-Hub';
        
        console.log('[newsletter] Processing subscription request');
        console.log('[newsletter] Repository:', GITHUB_REPO);
        console.log('[newsletter] Form data:', JSON.stringify(formData, null, 2));
        
        // For now, redirect to create an issue with pre-filled data
        // This is the secure way without exposing credentials
        const issueTitle = encodeURIComponent(`Newsletter Subscription: ${formData.name}`);
        const issueBody = encodeURIComponent(
            `**Name:** ${formData.name}\n` +
            `**Email:** ${formData.email}\n` +
            `**Subscribed At:** ${formData.subscribedAt}\n\n` +
            `\`\`\`json\n${JSON.stringify(formData, null, 2)}\n\`\`\``
        );
        
        const issueUrl = `https://github.com/${GITHUB_REPO}/issues/new?title=${issueTitle}&body=${issueBody}&labels=newsletter-subscription`;
        
        console.log('[newsletter] Redirecting to GitHub issue creation');
        console.log('[newsletter] Issue URL:', issueUrl);
        
        // For now, show a message and open the issue creation page
        messageDiv.className = 'message info';
        messageDiv.innerHTML = `<p>Please click below to confirm your subscription on GitHub:</p><a href="${issueUrl}" target="_blank" class="btn-primary">Confirm Subscription</a>`;
        messageDiv.style.display = 'block';
        
        // Also try to open the window
        window.open(issueUrl, '_blank');
        
        // Re-enable button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Subscribe';
        

        
        // Scroll to message
        messageDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        
    } catch (error) {
        console.error('[newsletter] EXCEPTION: Subscription submission failed');
        console.error('[newsletter] Error type:', error.constructor.name);
        console.error('[newsletter] Error message:', error.message);
        console.error('[newsletter] Error stack:', error.stack);
        console.error('[newsletter] Form data attempted:', JSON.stringify(formData, null, 2));
        
        messageDiv.className = 'message error';
        messageDiv.textContent = `Sorry, there was an error submitting your subscription: ${error.message}. Please try again later or contact support.`;
        messageDiv.style.display = 'block';
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Subscribe Now';
    }
}
        // Initialize on load
        init();
    </script>
</body>
</html>
